---
import { categorias, productos } from '../local-data/database.ts';
import ProductCard from './ProductCard.astro';

const categoriasConProductos = categorias.map(categoria => {
  const productosDeCategoria = productos
    .filter(p => p.categoria_id === categoria.id)
    .slice(0, 3); // Mostrar hasta 3 productos por categoría

  return {
    ...categoria,
    productos: productosDeCategoria,
  };
});
---

<section id="productos">
	<div class="container">
		<div class="section-header">
			<span class="section-label">Productos</span>
			<h2>Equipos de Alto Rendimiento para Minería y Construcción</h2>
			<p class="subtitle">
				Explora nuestro catálogo de maquinaria pesada, equipos y accesorios diseñados para superar los
				desafíos más exigentes de la industria.
			</p>
		</div>

		<div class="categories-grid">
			{categoriasConProductos.map(categoria => (
				<div class="category-section">
					<h3 class="category-title">{categoria.nombre}</h3>
					{categoria.productos.length > 0 ? (
						<div class="products-grid">
							{categoria.productos.map(producto => <ProductCard producto={producto} categorySlug={categoria.slug} />)}
						</div>
					) : (
						<p class="no-products">No hay productos disponibles en esta categoría por el momento.</p>
					)}
					<div class="category-footer">
						<a href={`/${categoria.slug}`} class="btn-more-products">Ver todos →</a>
					</div>
				</div>
			))}
		</div>
	</div>
</section>

<style>
	#productos {
		padding: 6rem 2rem;
		background-color: #f8f9fa;
	}

	.container {
		max-width: 1200px;
		width: 100%;
		margin: 0 auto;
	}

	.section-header {
		text-align: center;
		margin-bottom: 4rem;
	}

	.section-label {
		color: #e74c3c;
		font-weight: 600;
		text-transform: uppercase;
		font-size: 0.875rem;
		letter-spacing: 1px;
	}

	h2 {
		font-size: 2.5rem;
		color: #1a1a2e;
		margin-top: 1rem;
		line-height: 1.3;
		font-weight: 700;
	}

	.subtitle {
		max-width: 600px;
		margin: 1rem auto 0;
		color: #4a5568;
		line-height: 1.6;
	}

	.categories-grid {
		display: flex;
		flex-direction: column;
		gap: 4rem;
	}

	.category-section {
		background: white;
		padding: 2.5rem;
		border-radius: 16px;
		box-shadow: 0 8px 16px rgba(0, 0, 0, 0.05);
	}

	.category-title {
		font-size: 1.75rem;
		color: #1a1a2e;
		margin-bottom: 2rem;
		padding-bottom: 1rem;
		border-bottom: 3px solid #e74c3c;
		display: inline-block;
	}

	.products-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
		gap: 2rem;
	}

	.no-products {
		color: #6c757d;
		font-style: italic;
		padding: 2rem;
		text-align: center;
		background-color: #f8f9fa;
		border-radius: 8px;
	}

	.category-footer {
		text-align: right;
		margin-top: 2rem;
	}

	.btn-more-products {
		color: #e74c3c;
		text-decoration: none;
		font-weight: 600;
		transition: color 0.3s ease;
	}

	.btn-more-products:hover {
		color: #c0392b;
	}

	@media (max-width: 768px) {
		h2 {
			font-size: 2rem;
		}

		.category-section {
			padding: 1.5rem;
		}

		.category-title {
			font-size: 1.5rem;
		}
	}
</style>
